
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Simulation Run &#8212; DL_Software Digital Guide (DL_SDG) 2.1 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_CY.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Structures" href="../STRUCTURES/Structures.html" />
    <link rel="prev" title="Inputs Preparation" href="inputs_prep_dpd.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../STRUCTURES/Structures.html" title="Structures"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="inputs_prep_dpd.html" title="Inputs Preparation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">DL_Software Digital Guide (DL_SDG) 2.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Simulations.html" >Simulations</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="liquid_sim_dpd.html" accesskey="U">Simulating a liquid using DPD (DL_MESO)</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="simulation-run">
<h1>Simulation Run<a class="headerlink" href="#simulation-run" title="Permalink to this headline">¶</a></h1>
<p><strong>Step 1</strong>: If you have not yet done so, <a class="reference internal" href="../dl_meso_howto.html#dl-meso-howto"><span class="std std-ref">obtain and compile DL_MESO</span></a>, specifically DL_MESO_DPD and the utilities. If you have an implementation of MPI on your machine, the parallel version of DL_MESO_DPD is highly recommended; otherwise compile the serial version (using the makefile <strong>dl_meso/DPD/makefiles/Makefile-serial</strong>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">TIP:</th><td class="field-body">If you are using a high-performance computing (HPC) facility, it <em>might</em> have a pre-compiled DL_MESO module that you can load in and use, which should make the required executable files available to you when submitting a job. If it does not, you can still compile DL_MESO_DPD yourself using the instructions linked above, although you may need to consult the HPC facility’s documentation to find out how to load in compilers and MPI.</td>
</tr>
</tbody>
</table>
<p><strong>Step 2</strong>: Select your working folder, which can either be the <strong>dl_meso/WORK</strong> folder - where the DL_MESO and utility executables were created - or another folder of your choosing. If the latter, either copy the <strong>dpd.exe</strong> and other executable files (ending <strong>.exe</strong>) into that folder or work out the path to the <strong>dl_meso/WORK</strong> folder from that folder (e.g. use the command <code class="docutils literal notranslate"><span class="pre">pwd</span></code> to provide the absolute path).</p>
<p>Copy the <strong>CONTROL</strong> and <strong>FIELD</strong> files into your working folder.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">TIP:</th><td class="field-body">The DL_MESO_DPD executable (<strong>dpd.exe</strong>) expects the <strong>CONTROL</strong> and <strong>FIELD</strong> input files to be in the same directory where it is launched, and needs to find these files to run a simulation successfully.</td>
</tr>
</tbody>
</table>
<p><strong>Step 3</strong>: Navigate a terminal (command line) window into the working folder and either type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">dpd</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>to run the serial version of DL_MESO_DPD in that folder, or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="n">X</span> <span class="o">./</span><span class="n">dpd</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>to run the parallel version, substituting <code class="docutils literal notranslate"><span class="pre">X</span></code> with the required number of processor cores. If the <strong>dpd.exe</strong> executable is in a different folder, replace the dot in either command with the path to the <strong>dl_meso/WORK</strong> folder, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">dl_meso</span><span class="o">/</span><span class="n">WORK</span><span class="o">/</span><span class="n">dpd</span><span class="o">.</span><span class="n">exe</span>
<span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="n">X</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">dl_meso</span><span class="o">/</span><span class="n">WORK</span><span class="o">/</span><span class="n">dpd</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>If you are using a high-performance computing (HPC) service with a batch job manager (e.g. Slurm), you will need to write a job script to specify the computing resources (number of cores, runtime) and the <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> (or similar) command, which would be used to submit the calculation to a job queue. The form this job script should take and how to use it will depend on the HPC system in use, so you will need to consult its documentation for further details.</p>
<p>A number of files will be generated during the run, including an <strong>OUTPUT</strong> file describing the progression of the simulation, <strong>export</strong> and <strong>REVIVE</strong> files to enable simulation restart, a <strong>CORREL</strong> file with tabulated system properties and a <strong>HISTORY</strong> file with particle trajectories.</p>
<p>The images below show the contents of the <strong>OUTPUT</strong> file for the simple fluid example.</p>
<div class="figure">
<img alt="../../_images/OUTPUT_simple_dpd1.png" src="../../_images/OUTPUT_simple_dpd1.png" />
</div>
<p>This first image shows the point at which equilibration has finished and the sample period has begun, and reports instantaneous (first line for each given timestep) and rolling-average (second line) values for system-wide properties (e.g. energies per particle, pressure, temperature).</p>
<div class="figure">
<img alt="../../_images/OUTPUT_simple_dpd2.png" src="../../_images/OUTPUT_simple_dpd2.png" />
</div>
<p>The second image shows part of the summary written to the <strong>OUTPUT</strong> file once the calculation has finished, including average values and fluctuations (standard deviations) of system properties, including pressure tensors separated into four contributions, which are calculated during the simulation <em>after equilibration</em>.</p>
<p><strong>Step 4</strong>: Take a look at the values of system properties in the <strong>OUTPUT</strong> file (or the <strong>CORREL</strong> file) and check they are settling around average values after equilibration has taken place.</p>
<p>For a constant-volume (<em>NVT</em>) ensemble, the total potential energy per particle (<code class="docutils literal notranslate"><span class="pre">pe-total</span></code>) and system pressure should settle and oscillate around average values, indicating the system is likely to have reached an equilibrium state. In the example shown here (for a simple fluid), the potential energy per particle after equilibration is reported as <span class="math notranslate nohighlight">\(6.053 \pm 0.027\)</span>, which is markedly different from the value at the start of the simulation (<span class="math notranslate nohighlight">\(5.337\)</span>), while the pressure is reported as <span class="math notranslate nohighlight">\(23.69 \pm 0.22\)</span>. Both the potential energy and the system pressure are <em>configurational</em> properties, i.e. they depend on the positions or arrangements of particles in the system.</p>
<p>The system temperature for this static system (i.e. one with no applied flow field) should also settle and osscillate around an average value, which should ideally be close to the value specified in the <strong>CONTROL</strong> file. In this case, the temperature is reported as <span class="math notranslate nohighlight">\(1.004 \pm 0.015\)</span>, close to the specified value of 1. This <em>kinetic</em> property is dependent on particle velocities and should be controlled by the DPD thermostat (dissipative and random forces) in this instance.</p>
<p>The instantaneous values of these properties at each reported timestep can be checked against rolling average values, which sample the properties over a number of previous timesteps, to check whether or not the system is still moving towards an equilibrated state.</p>
<p><strong>Step 5</strong>: If the system properties have not yet settled and an equilibrium state has not yet been reached, the simulation can be extended further to give it more time to equilibrate. This can be achieved in DL_MESO_DPD without re-calculating previous timesteps by <em>restarting</em> the simulation.</p>
<p>Open the <strong>CONTROL</strong> file, increase the total number of timesteps (<code class="docutils literal notranslate"><span class="pre">steps</span></code>) and add the following line before the final <code class="docutils literal notranslate"><span class="pre">finish</span></code> directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restart</span>
</pre></div>
</div>
<p>before running DL_MESO_DPD again (Step 3).</p>
<p>Restarting DL_MESO_DPD requires an <strong>export</strong> file, which includes the system configuration (bead positions, velocities and forces) and is (over)written periodically by DL_MESO_DPD during a calculation.</p>
<p>Resuming a previous calculation from exactly where it left off additionally requires a <strong>REVIVE</strong> file, which is also generated periodically by DL_MESO_DPD during a calculation and contains statistical accumulators and random number generator states.</p>
<p>To start a new calculation without using the statistical accumulators in the <strong>REVIVE</strong> file, use the following line in the <strong>CONTROL</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restart</span> <span class="n">noscale</span>
</pre></div>
</div>
<p>which uses the state in the <strong>export</strong> file as the initial configuration for the new calculation. If the system temperature was very far away from the required value, use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restart</span> <span class="n">scale</span>
</pre></div>
</div>
<p>in the <strong>CONTROL</strong> file, which will also rescale the particle velocities in the <strong>export</strong> file to provide the correct temperature at the start of the calculation.</p>
<p><strong>Step 6</strong> (optional): To look at non-equilibrium hydrodynamic properties (e.g. viscosity), a linear shear flow with a constant velocity gradient can be applied to the simulation using Lees-Edwards periodic boundary conditions.</p>
<p>Open the <strong>CONTROL</strong> file and add the following line before <code class="docutils literal notranslate"><span class="pre">finish</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">surface</span> <span class="n">shear</span> <span class="n">y</span> <span class="mi">20000</span>
</pre></div>
</div>
<p>which tells DL_MESO_DPD to apply shear orthogonally to the y-axis, starting from timestep number 20000 (the number of equilibration timesteps). For analysis of this system, change the number at the end of the <code class="docutils literal notranslate"><span class="pre">trajectory</span></code> line from <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code>, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trajectory</span> <span class="mi">100000</span> <span class="mi">100</span> <span class="mi">1</span>
</pre></div>
</div>
<p>to include particle velocities in the <strong>HISTORY</strong> trajectory file. You may also wish to start sampling trajectories later to allow the system to settle to a steady-state and increase the sampling frequency.</p>
<p>Open the <strong>FIELD</strong> file and add the following two lines before <code class="docutils literal notranslate"><span class="pre">close</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXTERNAL</span>
<span class="n">shear</span>  <span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
</pre></div>
</div>
<p>which applies a velocity of <span class="math notranslate nohighlight">\((1.0, 0.0, 0.0)\)</span> (i.e. 1.0 in the x-direction) at the top wall and <span class="math notranslate nohighlight">\((-1.0, 0.0, 0.0)\)</span> at the bottom wall.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">TIPS:</th><td class="field-body">The wall velocities need to be sufficiently high for the shearing to be detected over the thermal motion (internal energy) of the beads, which sets a minimum shear rate (velocity gradient) for these simulations.</td>
</tr>
</tbody>
</table>
<div class="figure">
<img alt="../../_images/OUTPUT_simple_dpd3.png" src="../../_images/OUTPUT_simple_dpd3.png" />
</div>
<p>For systems with external flow fields, the <strong>OUTPUT</strong> file will include <em>partial temperatures</em> in each Cartesian direction, shown as <code class="docutils literal notranslate"><span class="pre">temp-x</span></code>, <code class="docutils literal notranslate"><span class="pre">temp-y</span></code> and <code class="docutils literal notranslate"><span class="pre">temp-z</span></code> in the above example for the simple fluid.</p>
<p>Both the system temperature and the partial temperature(s) for the Cartesian component(s) in which the shear is applied (in this case, the x-direction) will end up higher than the temperature specified in the <strong>CONTROL</strong> file due to the resulting flow field, but both properties should average out to constant values. The partial temperatures in other Cartesian directions (y- and z-directions) should not be affected by the flow field and therefore should settle to and oscillate around the value specified in <strong>CONTROL</strong>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../RST_PAGES/Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Resources.html">Resources</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Simulations.html">Simulations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="parameter_examples.html">Example Simulation Models and Procedures</a></li>
<li class="toctree-l2"><a class="reference internal" href="liquid_sim.html">Simulating a liquid (DL_FIELD, DL_POLY, DL_ANALYSER)</a></li>
<li class="toctree-l2"><a class="reference internal" href="solution_sim.html">Simulating a solution (DL_FIELD, DL_POLY, DL_ANALYSER)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="liquid_sim_dpd.html">Simulating a liquid using DPD (DL_MESO)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="inputs_prep_dpd.html">Inputs Preparation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Simulation Run</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../STRUCTURES/Structures.html">Structures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge.html">Knowledge Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RST_PAGES/Acknowledgements.html">Acknowledgements</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="inputs_prep_dpd.html"
                        title="previous chapter">Inputs Preparation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../STRUCTURES/Structures.html"
                        title="next chapter">Structures</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../STRUCTURES/Structures.html" title="Structures"
             >next</a> |</li>
        <li class="right" >
          <a href="inputs_prep_dpd.html" title="Inputs Preparation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">DL_Software Digital Guide (DL_SDG) 2.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Simulations.html" >Simulations</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="liquid_sim_dpd.html" >Simulating a liquid using DPD (DL_MESO)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, DL_SDG.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>